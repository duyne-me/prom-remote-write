# vmagent configuration for Dev Environment
# Cluster: ap-southeast-1-eks-01-dev
# Region: ap-southeast-1 (Singapore)
# Environment: dev

global:
  scrape_interval: 15s
  external_labels:
    env: "dev"
    region: "ap-southeast-1"
    storage_region: "us-east-1"  # VictoriaMetrics cluster location
    cluster: "ap-southeast-1-eks-01-dev"

scrape_configs:
  # Scrape mock exporter (application metrics)
  - job_name: "mock-exporter"
    static_configs:
      - targets: ["mock-exporter-python:2112"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: "mock-exporter-ap-southeast-1-dev"
  
  # Self-scrape for vmagent internal metrics (includes scrape_duration_seconds)
  - job_name: "vmagent"
    static_configs:
      - targets: ["localhost:8429"]
    relabel_configs:
      - target_label: instance
        replacement: "ap-southeast-1-eks-01-dev"
  
  # Blackbox exporter probes for cross-region latency monitoring
  # Probes endpoints in OTHER regions (us-east-1, eu-west-1, ap-northeast-1) to measure cross-region latency
  - job_name: "blackbox"
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      # Probe us-east-1 endpoint (cross-region from ap-southeast-1)
      - targets:
          - http://mock-exporter-python:2112/metrics
        labels:
          target_region: "us-east-1"
      # Probe eu-west-1 endpoint (cross-region from ap-southeast-1)
      - targets:
          - http://mock-exporter-python:2112/metrics
        labels:
          target_region: "eu-west-1"
      # Probe ap-northeast-1 endpoint (cross-region from ap-southeast-1)
      - targets:
          - http://mock-exporter-python:2112/metrics
        labels:
          target_region: "ap-northeast-1"
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: target
      - target_label: __address__
        replacement: blackbox-exporter:9115
      - target_label: source_region
        replacement: "ap-southeast-1"
      - target_label: source_env
        replacement: "dev"
      # Keep target_region label from static_configs
      - source_labels: [target_region]
        target_label: target_region

