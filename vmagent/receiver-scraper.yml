# vmagent configuration for Receiver Scraper
# Purpose: Scrape prometheus-receiver metrics and forward to VictoriaMetrics
# Flow: External/Legacy → prometheus-receiver → vmagent-receiver-scraper → vminsert

global:
  scrape_interval: 15s
  external_labels:
    env: "prod"
    region: "us-east-1"
    storage_region: "us-east-1"  # VictoriaMetrics cluster location
    cluster: "us-east-1-eks-01-prod-legacy"

scrape_configs:
  # Scrape Prometheus Receiver metrics
  # Note: Use internal port 9090 (not 9091 which is external host port)
  - job_name: "prometheus-receiver"
    static_configs:
      - targets: ["prometheus-receiver:9090"]
    relabel_configs:
      - target_label: instance
        replacement: "prometheus-receiver"
  
  # Self-scrape for vmagent internal metrics
  - job_name: "vmagent"
    static_configs:
      - targets: ["localhost:8429"]
    relabel_configs:
      - target_label: instance
        replacement: "us-east-1-eks-01-prod-legacy"

