# vmagent configuration for Production Environment - Cluster 1
# Cluster: us-east-1-eks-01-prod
# Region: us-east-1 (N. Virginia)
# Environment: prod
# High Availability: Cluster 1 of 2

global:
  scrape_interval: 15s
  external_labels:
    env: "prod"
    region: "us-east-1"
    storage_region: "us-east-1"  # VictoriaMetrics cluster location
    cluster: "us-east-1-eks-01-prod"

scrape_configs:
  # Scrape mock exporter (application metrics)
  - job_name: "mock-exporter"
    static_configs:
      - targets: ["mock-exporter-python:2112"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: "mock-exporter-us-east-1-prod-01"
  
  # Self-scrape for vmagent internal metrics (includes scrape_duration_seconds)
  - job_name: "vmagent"
    static_configs:
      - targets: ["localhost:8429"]
    relabel_configs:
      - target_label: job
        replacement: "vmagent-self"
  
  # Blackbox exporter probes for cross-region latency monitoring
  # Probes endpoints in OTHER regions (ap-southeast-1, eu-west-1) to measure cross-region latency
  - job_name: "blackbox"
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      # Probe ap-southeast-1 endpoint (cross-region from us-east-1)
      - targets:
          - http://mock-exporter-python:2112/metrics
        labels:
          target_region: "ap-southeast-1"
      # Probe eu-west-1 endpoint (cross-region from us-east-1)
      - targets:
          - http://mock-exporter-python:2112/metrics
        labels:
          target_region: "eu-west-1"
      # Probe ap-northeast-1 endpoint (cross-region from us-east-1)
      - targets:
          - http://mock-exporter-python:2112/metrics
        labels:
          target_region: "ap-northeast-1"
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: target
      - target_label: __address__
        replacement: blackbox-exporter:9115
      - target_label: source_region
        replacement: "us-east-1"
      - target_label: source_env
        replacement: "prod"
      - target_label: source_cluster
        replacement: "us-east-1-eks-01-prod"
      # Keep target_region label from static_configs
      - source_labels: [target_region]
        target_label: target_region

